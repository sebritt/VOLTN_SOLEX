<!DOCTYPE html> 
<html>
<head>
  <meta charset="utf-8">
  <title>Choix du Mode</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    form { margin-bottom: 30px; }
    label { display: block; margin-top: 10px; }
    button.refresh {
      margin-top: 5px;
      background-color: #eee;
      border: 1px solid #ccc;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Choisissez une source de donnÃ©es GPS</h1>

  <h2>ðŸ”Œ Lecture en direct (sÃ©rie)</h2>
  <form action="/live" method="post">
    <label for="port">Port sÃ©rie :</label>
    <select name="port" id="port-select">
      {% for port in ports %}
        <option value="{{ port }}">{{ port }}</option>
      {% endfor %}
    </select>
    <button type="submit">DÃ©marrer</button>
    <button type="button" class="refresh" onclick="refreshPorts()">ðŸ”„ RafraÃ®chir les ports</button>
  </form>

  <h2>ðŸ“‚ Charger un fichier CSV</h2>
  <form action="/upload" method="post" enctype="multipart/form-data">
    <label for="csvfile">Fichier CSV :</label>
    <input type="file" name="csvfile" required>
    <button type="submit">Charger</button>
  </form>

  <script>
    async function refreshPorts() {
      const res = await fetch('/ports');
      const ports = await res.json();
      const select = document.getElementById('port-select');
      select.innerHTML = '';
      if (ports.length === 0) {
        const opt = document.createElement('option');
        opt.textContent = 'Aucun port dÃ©tectÃ©';
        opt.disabled = true;
        select.appendChild(opt);
      } else {
        ports.forEach(port => {
          const opt = document.createElement('option');
          opt.value = port;
          opt.textContent = port;
          select.appendChild(opt);
        });
      }
    }
  </script>
</body>
</html>
